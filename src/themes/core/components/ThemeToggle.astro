---
const id = "theme-toggle-" + Math.random().toString(36).slice(2);
---

<button
  id={id}
  type="button"
  class="ml-3 flex h-9 w-9 items-center justify-center rounded-full border border-black/10 bg-gray-100 text-lg leading-none text-black transition hover:bg-gray-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-black dark:border-white/20 dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700 focus-visible:dark:outline-white"
  client:load
  data-theme-toggle
  aria-pressed="false"
  aria-label="Attiva il tema scuro"
>
  <span aria-hidden="true" data-theme-icon>‚òÄÔ∏è</span>
  <span class="sr-only" data-theme-label>Attiva il tema scuro</span>
</button>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const buttons = Array.from(document.querySelectorAll("[data-theme-toggle]"));

    if (!buttons.length) return;

    function updateButtons(isDark) {
      const actionLabel = isDark ? "Attiva il tema chiaro" : "Attiva il tema scuro";
      buttons.forEach((btn) => {
        const icon = btn.querySelector("[data-theme-icon]");
        const label = btn.querySelector("[data-theme-label]");
        if (icon) icon.textContent = isDark ? "üåô" : "‚òÄÔ∏è";
        if (label) label.textContent = actionLabel;
        btn.setAttribute("aria-label", actionLabel);
        btn.setAttribute("aria-pressed", String(isDark));
      });
    }

    function setTheme(mode) {
      const isDark = mode === "dark";
      document.documentElement.classList.toggle("dark", isDark);
      localStorage.setItem("theme", isDark ? "dark" : "light");
      updateButtons(isDark);
    }

    const saved = localStorage.getItem("theme");
    if (saved === "dark" || saved === "light") {
      setTheme(saved);
    } else {
      setTheme("light");
    }

    buttons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const isDark = document.documentElement.classList.contains("dark");
        setTheme(isDark ? "light" : "dark");
      });
    });
  });
</script>
