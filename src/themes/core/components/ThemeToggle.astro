---
const id = "theme-toggle-" + Math.random().toString(36).slice(2);
---

<button
  id={id}
  type="button"
  class="ml-3 px-3 py-1 rounded border text-sm bg-gray-100 dark:bg-gray-800 dark:text-gray-200"
  client:load
  data-theme-toggle
>
  🌙 Dark
</button>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const buttons = Array.from(document.querySelectorAll("[data-theme-toggle]"));

    if (!buttons.length) return; // sicurezza

    function setTheme(mode) {
      const isDark = mode === "dark";
      document.documentElement.classList.toggle("dark", isDark);
      localStorage.setItem("theme", isDark ? "dark" : "light");
      buttons.forEach((btn) => {
        btn.textContent = isDark ? "☀️ Light" : "🌙 Dark";
      });
    }

    // On load
    const saved = localStorage.getItem("theme");
    if (saved === "dark" || saved === "light") {
      setTheme(saved);
    } else if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      setTheme("dark");
    } else {
      setTheme("light");
    }

    // On click
    buttons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const isDark = document.documentElement.classList.contains("dark");
        setTheme(isDark ? "light" : "dark");
      });
    });
  });
</script>
