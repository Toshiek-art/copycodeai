---
// src/pages/writing/index.astro
import { sanityClient } from "../../lib/sanity";
import BaseLayout from "../../layouts/BaseLayout.astro";

// 1. Prendiamo tutti i post da Sanity
const query = `*[_type == "post" && defined(slug.current)] | order(publishedAt desc)`;
const posts = await sanityClient.fetch(query);

console.log("ARTICOLI RICEVUTI DA SANITY:", posts);
---

<BaseLayout title="Writing" page="writing">
  <div class="container mx-auto px-4 py-12">
    <h1 class="text-4xl font-bold mb-8">Dal mio Blog (da Sanity)</h1>

    <ul class="space-y-6">
      {
        posts.length > 0 ? (
          posts.map((post) => (
            <li>
              {/* 2. Il link punta alla pagina dinamica che gi√† esiste */}
              <a href={`/writing/${post.slug.current}`} class="block p-4 border rounded-lg hover:bg-gray-100">
                <h2 class="text-2xl font-semibold">{post.title}</h2>
                <p class="text-gray-600 mt-2">
                  Pubblicato il: {new Date(post.publishedAt).toLocaleDateString('it-IT')}
                </p>
              </a>
            </li>
          ))
        ) : (
          <p>Nessun articolo trovato. Prova a pubblicarne uno dal CMS!</p>
        )
      }
    </ul>
  </div>
</BaseLayout>
